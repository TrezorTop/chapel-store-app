datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}


generator client {
  provider = "prisma-client-js"
}


model User {
    username String @id
    passwordHash String
    role Role @default(USER)
    tokens RefreshToken[]
    purchases Purchases[]
    uncomittedOrders UncomittedOrders[]

    createdAt DateTime @default(now())
}


enum Role {
  USER
  ADMIN
}


model RefreshToken {
    token String @id
    owner User @relation(fields: [ownerUsername], references: [username], onDelete: Restrict)
    ownerUsername String
}


model Car {
    id String @id @default(cuid())
    name String @unique
    configs Config[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt @default(now())
}


model Bundle {
    id String @id @default(cuid())
    name String @unique
    configs BundleConfigs[]
    price Decimal
    softDeleted Boolean @default(false)
    purchases Purchases[]
    uncomittedOrders UncomittedOrders[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt @default(now())
}


model Purchases {
    owner User @relation(fields: [ownerUsername], references: [username], onDelete: Restrict)
    ownerUsername String
    bundle Bundle @relation(fields: [bundleId], references: [id], onDelete: Restrict)
    bundleId String
    @@id([ownerUsername, bundleId])

    new String

    createdAt DateTime @default(now())
}


model UncomittedOrders {
    id String @id @default(cuid())
    owner User @relation(fields: [ownerUsername], references: [username], onDelete: Restrict)
    ownerUsername String
    bundle Bundle @relation(fields: [bundleId], references: [id], onDelete: Restrict)
    bundleId String
}


model BundleConfigs {
    bundle Bundle @relation(fields: [bundleId], references: [id], onDelete: Restrict)
    bundleId String
    config Config @relation(fields: [configId], references: [id], onDelete: Restrict)
    configId String

    @@id([bundleId, configId])
}


model Config {
    id String @id @default(cuid())
    title String
    car Car @relation(fields: [carId], references: [id], onDelete: Restrict)
    carId String

    bundles BundleConfigs[]
    files File[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt @default(now())
}


model File {
    name String @id
    originalName String
    size String
    config Config @relation(fields: [configId], references: [id], onDelete: Cascade)
    configId String
}